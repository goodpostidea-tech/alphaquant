# 07 - 开发指南

[← 返回主目录](../README.md)

---

## 🗺️ 开发路线图

### Phase 1：基础设施搭建（2-4周）

#### Week 1-2：环境准备
- [ ] Next.js 项目初始化
```bash
npx create-next-app@latest alpha-arena --typescript --tailwind --app
cd alpha-arena
```

- [ ] 安装核心依赖
```bash
npm install chart.js react-chartjs-2
npm install @tanstack/react-query  # 数据获取
npm install zustand                 # 状态管理
npm install prisma @prisma/client   # 数据库ORM
npm install ioredis                 # Redis客户端
```

- [ ] 数据库搭建
  - [ ] PostgreSQL部署（Supabase/Neon）
  - [ ] Redis部署（Upstash）
  - [ ] Prisma Schema设计
  - [ ] 数据库迁移脚本

#### Week 3-4：交易所集成
- [ ] Hyperliquid账户注册
- [ ] 创建6个独立钱包
- [ ] API密钥配置
- [ ] 测试网环境测试
  - [ ] 市价单/限价单
  - [ ] 杠杆设置
  - [ ] 持仓查询
  - [ ] 账户余额查询

---

### Phase 2：核心功能开发（4-6周）

#### Week 5-6：LLM集成
- [ ] 设计统一提示词模板
- [ ] 实现6个LLM适配器
  - [ ] GPT-5 (OpenAI API)
  - [ ] Claude 4.5 (Anthropic API)
  - [ ] Gemini 2.5 (Google AI API)
  - [ ] Grok 4 (xAI API)
  - [ ] DeepSeek V3.1 (DeepSeek API)
  - [ ] Qwen 3 Max (Alibaba Cloud API)
- [ ] 响应解析器（容错处理）
- [ ] 单元测试（模拟API响应）

#### Week 7-8：交易执行引擎
- [ ] 风险管理模块
  - [ ] 杠杆限制检查
  - [ ] 头寸大小限制
  - [ ] 保证金充足性检查
  - [ ] 总风险敞口控制
- [ ] 交易执行模块
  - [ ] 订单提交
  - [ ] 执行结果处理
  - [ ] 失败重试逻辑
  - [ ] 滑点控制
- [ ] 持仓管理模块
  - [ ] 持仓跟踪
  - [ ] 盈亏计算
  - [ ] 强平监控

#### Week 9-10：AI决策调度
- [ ] Cron Job设置（每5-15分钟）
- [ ] 决策流程编排
- [ ] 并行调用优化
- [ ] 错误处理和日志
- [ ] 对话记录存储

---

### Phase 3：前端界面开发（3-4周）

#### Week 11：首页开发
- [ ] 顶部价格滚动条
  - [ ] 6种币实时价格
  - [ ] 数字滚动动画
  - [ ] 每秒更新
- [ ] 统计栏（HIGHEST/LOWEST）
- [ ] 主图表组件
  - [ ] 多线折线图
  - [ ] 时间范围切换（ALL/72H）
  - [ ] 显示模式切换（$/%)
  - [ ] Tooltip交互
- [ ] 模型列表卡片

#### Week 12：标签页开发
- [ ] COMPLETED TRADES
  - [ ] 交易列表
  - [ ] 筛选器
  - [ ] 分页/虚拟滚动
- [ ] MODELCHAT
  - [ ] 对话记录展示
  - [ ] Markdown渲染
  - [ ] LaTeX支持（可选）
  - [ ] 展开/折叠功能
- [ ] POSITIONS
  - [ ] 持仓卡片
  - [ ] 实时盈亏更新
  - [ ] 筛选功能
- [ ] README.TXT
  - [ ] 静态内容展示
  - [ ] 终端风格设计

#### Week 13：排行榜页面
- [ ] 排行榜表格
  - [ ] 可排序功能
  - [ ] 10个指标列
  - [ ] 响应式设计
- [ ] 侧边栏
  - [ ] WINNING MODEL
  - [ ] ACTIVE POSITIONS
  - [ ] 可视化排名条
- [ ] 功能按钮
  - [ ] OVERALL STATS弹窗
  - [ ] ADVANCED ANALYTICS

#### Week 14：模型详情页
- [ ] 头部信息卡
- [ ] 核心统计卡片
- [ ] HOLD TIMES分布图
- [ ] ACTIVE POSITIONS列表
  - [ ] Exit Plan展开
  - [ ] 实时更新
- [ ] LAST 25 TRADES表格
- [ ] 返回导航

---

### Phase 4：测试与优化（2-3周）

#### Week 15：功能测试
- [ ] 单元测试
  - [ ] LLM适配器测试
  - [ ] 风控模块测试
  - [ ] 数据库操作测试
- [ ] 集成测试
  - [ ] API端点测试
  - [ ] 交易流程测试
- [ ] E2E测试
  - [ ] 用户场景测试
  - [ ] 跨浏览器测试

#### Week 16：性能优化
- [ ] 前端优化
  - [ ] 代码分割
  - [ ] 图片优化
  - [ ] 懒加载
  - [ ] 缓存策略
- [ ] 后端优化
  - [ ] 数据库索引
  - [ ] 查询优化
  - [ ] API缓存
  - [ ] 批量处理

#### Week 17：安全审计
- [ ] API密钥安全检查
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] CSRF防护
- [ ] 钱包私钥加密存储
- [ ] 环境变量隔离

---

### Phase 5：部署与运维（1-2周）

#### Week 18：部署上线
- [ ] Vercel部署配置
- [ ] 环境变量配置
- [ ] 数据库连接配置
- [ ] Redis连接配置
- [ ] 域名配置
- [ ] SSL证书

#### Week 19：监控与运维
- [ ] Sentry错误追踪
- [ ] Vercel Analytics
- [ ] 日志系统（Datadog/LogRocket）
- [ ] 告警系统（异常交易、API失败）
- [ ] 备份策略（数据库每日备份）
- [ ] 灾难恢复预案

---

## 💰 成本估算

### LLM API 成本

假设每个模型**每15分钟**调用一次（每天96次）：

| 模型 | API提供商 | 单次成本 | 每日成本 | 每月成本 |
|------|----------|---------|---------|---------|
| GPT-5 | OpenAI | ~$0.05 | $4.80 | $144.00 |
| Claude Sonnet 4.5 | Anthropic | ~$0.03 | $2.88 | $86.40 |
| Gemini 2.5 Pro | Google | ~$0.02 | $1.92 | $57.60 |
| Grok 4 | xAI | ~$0.04 | $3.84 | $115.20 |
| DeepSeek V3.1 | DeepSeek | ~$0.01 | $0.96 | $28.80 |
| Qwen 3 Max | Alibaba | ~$0.015 | $1.44 | $43.20 |
| **总计** | - | **~$0.155** | **$15.84** | **$475.20** |

**备注**：
- 成本基于2025年Q4价格估算
- 实际成本取决于token数量
- DeepSeek和Qwen相对便宜

### 基础设施成本

| 服务 | 提供商 | 规格 | 月成本 |
|------|-------|------|--------|
| Vercel | Vercel | Pro Plan | $20 |
| PostgreSQL | Supabase/Neon | Pro (10GB) | $25-50 |
| Redis | Upstash | Pay-as-you-go | $10-20 |
| 监控 | Sentry | Team | $26 |
| 分析 | Vercel Analytics | Included | $0 |
| **总计** | - | - | **$81-116** |

### 交易资金

| 项目 | 数量 | 单价 | 总计 |
|------|------|------|------|
| AI模型资金 | 6个 | $10,000 | $60,000 |
| 缓冲资金 | 1份 | $10,000 | $10,000 |
| **总计** | - | - | **$70,000** |

**备注**：
- 资金可回收（竞赛结束后）
- 手续费约$2,000-3,000会损耗
- 盈亏影响最终回收金额

### 总成本估算

**开发阶段（一次性）**：
- 内部开发：2-3个月 × 开发人员成本
- 或外包：$30,000-50,000

**运营成本（每月）**：
- LLM API：$475
- 基础设施：$100
- **月成本：~$575**

**初始投入**：
- 开发成本：$30,000-50,000
- 交易资金：$70,000（可回收）
- **总初始投入：$100,000-120,000**

---

## ✅ 开发检查清单

### 开发前准备

- [ ] 完成产品需求文档（PRD）
- [ ] 完成UI/UX设计（Figma原型）
- [ ] 确定技术栈和架构
- [ ] 申请所有API密钥
  - [ ] OpenAI API Key
  - [ ] Anthropic API Key
  - [ ] Google AI API Key
  - [ ] xAI API Key
  - [ ] DeepSeek API Key
  - [ ] Alibaba Cloud API Key
- [ ] 注册Hyperliquid账户
- [ ] 创建测试钱包
- [ ] 准备测试数据

### 数据库开发

- [ ] Prisma Schema设计
```prisma
model Model {
  id            String   @id
  name          String
  provider      String
  walletAddress String   @unique
  trades        Trade[]
  positions     Position[]
  conversations Conversation[]
}

model Trade {
  id             Int      @id @default(autoincrement())
  modelId        String
  model          Model    @relation(fields: [modelId], references: [id])
  coin           String
  side           String
  entryPrice     Decimal
  exitPrice      Decimal?
  quantity       Decimal
  leverage       Int
  entryTime      DateTime
  exitTime       DateTime?
  fees           Decimal
  netPnL         Decimal?
}
```

- [ ] 数据库迁移
- [ ] 种子数据（Seed）
- [ ] 索引优化

### API开发

- [ ] `/api/crypto-prices` - 实时价格
- [ ] `/api/account-totals` - 账户总值
- [ ] `/api/trades` - 交易历史
- [ ] `/api/positions` - 当前持仓
- [ ] `/api/leaderboard` - 排行榜
- [ ] `/api/conversations` - AI对话
- [ ] `/api/models/:id` - 模型详情
- [ ] 错误处理中间件
- [ ] 速率限制
- [ ] CORS配置

### 前端组件开发

#### 通用组件
- [ ] `<Header />` - 顶部导航
- [ ] `<PriceTickerBar />` - 价格滚动条
- [ ] `<RollingNumber />` - 数字滚动动画
- [ ] `<LoadingSkeleton />` - 骨架屏
- [ ] `<ErrorBoundary />` - 错误边界

#### 图表组件
- [ ] `<AccountValueChart />` - 账户价值图表
- [ ] `<HoldTimesPieChart />` - 持仓时间饼图
- [ ] `<ModelCard />` - 模型卡片

#### 业务组件
- [ ] `<TradeList />` - 交易列表
- [ ] `<PositionCard />` - 持仓卡片
- [ ] `<ConversationCard />` - 对话卡片
- [ ] `<LeaderboardTable />` - 排行榜表格
- [ ] `<StatsCard />` - 统计卡片

### 功能开发

- [ ] 实时数据轮询（5秒间隔）
- [ ] WebSocket连接（备选）
- [ ] 图表交互（hover, click）
- [ ] 表格排序功能
- [ ] 筛选器功能
- [ ] 时间范围切换
- [ ] 显示模式切换（$/%)
- [ ] 移动端适配

### 测试

- [ ] Jest单元测试（覆盖率>80%）
- [ ] Playwright E2E测试
- [ ] 性能测试（Lighthouse>90）
- [ ] 跨浏览器测试
- [ ] 移动端测试

---

## 💻 快速启动（MVP版本）

### 最小可行产品（2周冲刺）

#### 目标
用最少资源验证核心概念

#### 简化方案
- **模型数量**：2个（GPT-4 + Claude）
- **交易对**：1个（仅BTC/USDT）
- **交易方式**：模拟交易（不用真钱）
- **更新频率**：每小时一次
- **功能**：基础图表 + 简单排行榜

#### MVP技术栈
```bash
# 最简技术栈
- Next.js
- SQLite（本地数据库）
- 免费LLM API（如GPT-3.5）
- Chart.js
- 不需要Redis
- 不需要WebSocket
```

#### MVP开发步骤

**Day 1-3：基础框架**
```bash
# 1. 初始化项目
npx create-next-app@latest mvp-alpha-arena

# 2. 安装依赖
npm install chart.js react-chartjs-2 better-sqlite3

# 3. 创建数据库
touch prisma/schema.prisma
```

**Day 4-7：后端逻辑**
- 实现2个LLM适配器
- 简单提示词模板
- 模拟交易执行
- SQLite数据存储

**Day 8-11：前端界面**
- 基础图表
- 简单表格
- 无高级交互

**Day 12-14：测试部署**
- 本地测试
- Vercel部署
- 分享给朋友测试

---

## 📋 完整开发检查清单

### 阶段1：准备（✓ = 完成）

#### 需求分析
- [ ] 用户调研
- [ ] 竞品分析
- [ ] 功能优先级排序
- [ ] 技术选型决策

#### 设计
- [ ] UI设计稿（Figma）
- [ ] 交互原型
- [ ] 数据库ER图
- [ ] API接口文档
- [ ] 系统架构图

#### 环境准备
- [ ] GitHub仓库创建
- [ ] 项目管理工具（Jira/Linear）
- [ ] 代码规范文档
- [ ] Git工作流规范

---

### 阶段2：开发

#### 后端
- [ ] 数据模型设计
- [ ] API路由实现
- [ ] 数据库迁移
- [ ] LLM集成
- [ ] 交易执行逻辑
- [ ] 风控系统
- [ ] Cron Jobs
- [ ] 单元测试

#### 前端
- [ ] 组件库搭建
- [ ] 页面开发
- [ ] 状态管理
- [ ] 实时更新
- [ ] 响应式设计
- [ ] 无障碍支持
- [ ] 组件测试

---

### 阶段3：测试

#### 功能测试
- [ ] 所有API端点
- [ ] 所有页面功能
- [ ] 所有交互功能
- [ ] 边界条件测试
- [ ] 错误处理测试

#### 性能测试
- [ ] Lighthouse评分
- [ ] 加载时间测试
- [ ] 并发用户测试
- [ ] 数据库压力测试
- [ ] API响应时间

#### 兼容性测试
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge
- [ ] 移动端浏览器

---

### 阶段4：部署

#### 部署清单
- [ ] 生产环境配置
- [ ] 环境变量设置
- [ ] 数据库迁移（生产）
- [ ] SSL证书配置
- [ ] CDN配置
- [ ] 监控配置
- [ ] 备份配置

#### 上线前检查
- [ ] 安全扫描
- [ ] 性能测试通过
- [ ] 备份恢复测试
- [ ] 监控告警测试
- [ ] 回滚预案准备

---

### 阶段5：运维

#### 日常监控
- [ ] 错误率监控
- [ ] 响应时间监控
- [ ] 数据库性能
- [ ] API调用量
- [ ] 用户访问量

#### 定期维护
- [ ] 数据库备份验证（每周）
- [ ] 日志清理（每月）
- [ ] 依赖更新（每月）
- [ ] 安全更新（及时）
- [ ] 性能报告（每月）

---

## 🛠️ 开发工具推荐

### IDE
- **VS Code**：最流行
- **推荐插件**：
  - ESLint
  - Prettier
  - Tailwind CSS IntelliSense
  - Prisma
  - GitLens

### 数据库工具
- **Prisma Studio**：可视化数据库管理
- **TablePlus**：数据库客户端
- **Redis Insight**：Redis可视化

### API测试
- **Postman**：API测试
- **Insomnia**：API调试
- **Thunder Client**：VS Code插件

### 监控调试
- **Sentry**：错误追踪
- **LogRocket**：会话回放
- **Chrome DevTools**：前端调试

---

## 📦 推荐技术栈

### 最终推荐方案

```yaml
前端:
  框架: Next.js 14 + React 18
  语言: TypeScript
  样式: Tailwind CSS
  图表: Chart.js
  状态: Zustand / TanStack Query
  
后端:
  API: Next.js API Routes
  语言: TypeScript
  数据库: PostgreSQL (Supabase)
  缓存: Redis (Upstash)
  ORM: Prisma
  
部署:
  平台: Vercel
  数据库: Supabase
  缓存: Upstash Redis
  监控: Sentry
  
交易:
  平台: Hyperliquid
  SDK: 官方SDK / REST API
  
AI:
  提供商: OpenAI, Anthropic, Google, xAI, DeepSeek, Alibaba
  调用方式: REST API
```

---

## 📊 项目里程碑

### 里程碑1：MVP完成（Week 14）
- ✅ 基础交易功能
- ✅ 2个AI模型对比
- ✅ 简单图表展示
- ✅ 本地部署成功

### 里程碑2：Beta版本（Week 17）
- ✅ 6个AI模型全部集成
- ✅ 完整UI实现
- ✅ 真实交易测试
- ✅ 性能优化完成

### 里程碑3：正式上线（Week 19）
- ✅ 生产环境部署
- ✅ 监控系统完善
- ✅ 公开发布
- ✅ 社区推广

---

## ⚠️ 常见问题

### Q1：LLM输出格式不一致怎么办？
**A：**多层次解析策略
```typescript
function parseLLMResponse(text: string): TradingDecision {
  try {
    // 尝试直接JSON解析
    return JSON.parse(text);
  } catch {
    // 提取JSON代码块
    const match = text.match(/```json\n(.*?)\n```/s);
    if (match) return JSON.parse(match[1]);
    
    // 提取第一个{}
    const jsonMatch = text.match(/\{[^]*\}/);
    if (jsonMatch) return JSON.parse(jsonMatch[0]);
    
    // 失败返回默认HOLD
    return { action: 'HOLD', reasoning: 'Parse failed' };
  }
}
```

### Q2：如何处理API调用失败？
**A：**重试 + 降级策略
```typescript
async function callLLMWithRetry(adapter, prompt, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await adapter.callModel(prompt);
    } catch (error) {
      if (i === maxRetries - 1) {
        // 最后一次失败，返回HOLD决策
        return {
          response: 'API call failed',
          decision: { action: 'HOLD', reasoning: 'API unavailable' }
        };
      }
      await sleep(1000 * (i + 1)); // 指数退避
    }
  }
}
```

### Q3：如何防止重复交易？
**A：**幂等性设计
```typescript
// 使用唯一ID防止重复
const tradeId = `${modelId}-${timestamp}-${coin}-${side}`;
const exists = await redis.get(`trade:${tradeId}`);

if (exists) {
  console.log('Trade already executed');
  return;
}

// 执行交易
await executeTrade(decision);

// 标记已执行
await redis.setex(`trade:${tradeId}`, 3600, 'executed');
```

---

## 🎯 成功关键因素

### 1. 数据准确性
- ✅ 价格数据及时准确
- ✅ 交易执行可靠
- ✅ 账户同步准确

### 2. AI提示词质量
- ✅ 提供充分信息
- ✅ 格式清晰统一
- ✅ 引导输出格式

### 3. 系统稳定性
- ✅ 24/7不间断运行
- ✅ 故障自动恢复
- ✅ 监控告警及时

### 4. 用户体验
- ✅ 加载速度快
- ✅ 实时性好
- ✅ 界面美观

### 5. 透明度
- ✅ 所有数据公开
- ✅ 可验证性强
- ✅ 无黑箱操作

---

## 导航

- [← 返回主目录](../README.md)
- [← 上一章：核心功能实现](06-核心功能实现.md)
- [下一章：技术难点解决方案 →](08-技术难点.md)


